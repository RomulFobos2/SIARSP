package com.mai.siarsp.models;

import jakarta.persistence.*;
import lombok.Data;
import lombok.EqualsAndHashCode;
import lombok.NoArgsConstructor;
import lombok.ToString;

import java.util.ArrayList;
import java.util.List;

/**
 * Стеллаж на складе
 *
 * Физическая конструкция для хранения товара на складе ИП "Левчук".
 * Стеллаж состоит из множества полок (StorageZone), на которых размещается товар.
 * Является средним уровнем в иерархии: Склад → Стеллаж → Полка → Товар.
 *
 * Иерархия складского учета:
 * Warehouse (Основной склад / Холодильный склад)
 *   → Shelf (Стеллаж A, Стеллаж B, Стеллаж C...)
 *     → StorageZone (Полка A1, Полка A2, Полка A3...)
 *       → ZoneProduct (Молоко 3.2% - 50 шт., Хлеб - 30 шт...)
 *
 * Назначение:
 * - Логическая группировка полок для удобства навигации
 * - Физическое разделение пространства склада
 * - Оптимизация размещения товара (группировка по категориям)
 * - Облегчение поиска товара на складе
 *
 * Примеры организации:
 * - Склад "Основной": Стеллаж A (молочная продукция), Стеллаж B (хлеб), Стеллаж C (овощи)
 * - Склад "Холодильный": Стеллаж R1 (мясо), Стеллаж R2 (рыба), Стеллаж R3 (заморозка)
 *
 * Согласно ТЗ, система должна подсчитывать оставшееся место на складе,
 * для чего необходима детальная структура с габаритами полок на стеллажах.
 *
 * Связи:
 * - Принадлежит одному складу (Warehouse)
 * - Содержит множество полок (StorageZone)
 */
@Data
@NoArgsConstructor
@Entity
@Table(name = "t_shelf")
@EqualsAndHashCode(of = "id")
public class Shelf {

    // ========== ПОЛЯ ==========
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    /**
     * Код (номер) стеллажа
     * Уникальный идентификатор стеллажа в рамках склада
     *
     * Примеры:
     * - "A", "B", "C", "D" (буквенная нумерация)
     * - "ST-01", "ST-02", "ST-03" (с префиксом)
     * - "R1", "R2", "R3" (для холодильного склада)
     * - "МОЛ-1", "ХЛБ-1" (по типу товара)
     *
     * Используется для:
     * - Идентификации стеллажа при размещении товара
     * - Навигации на складе (заведующий говорит: "Положи молоко на стеллаж A")
     * - Формирования схемы склада
     * - Поиска товара ("Молоко находится на стеллаже A, полка 2")
     * - Отчетности по загрузке стеллажей
     *
     * Обычно короткий и легко произносимый код для удобства устного общения
     */
    @Column(nullable = false)
    private String code;

    /**
     * Склад, к которому относится стеллаж
     * Один стеллаж принадлежит только одному складу
     *
     * Связь с основной сущностью склада, которая определяет:
     * - Тип склада (обычный/холодильный)
     * - Общую емкость склада
     * - Какие товары могут храниться
     *
     * Примеры:
     * - Стеллаж "A" на складе "Основной склад"
     * - Стеллаж "R1" на складе "Холодильный склад"
     *
     * Важно для бизнес-правил:
     * - На стеллаже в холодильном складе могут быть только товары,
     *   требующие холодильного хранения (Product.warehouseType = REFRIGERATED)
     * - На стеллаже в обычном складе не должно быть скоропортящихся товаров
     */
    @ToString.Exclude
    @ManyToOne
    @JoinColumn(nullable = false)
    private Warehouse warehouse;

    /**
     * Список полок (зон хранения) на стеллаже
     * Каждая полка имеет свои габариты и может содержать товары
     *
     * Структура стеллажа:
     * Стеллаж "A":
     *   - Полка "A1" (длина: 200 см, ширина: 80 см, высота: 40 см)
     *   - Полка "A2" (длина: 200 см, ширина: 80 см, высота: 40 см)
     *   - Полка "A3" (длина: 200 см, ширина: 80 см, высота: 40 см)
     *   - ...
     *
     * Каждая полка (StorageZone):
     * - Имеет метку (label) для идентификации: "A1", "A2", "A3"...
     * - Имеет габариты (length, width, height) в сантиметрах
     * - Содержит список товаров (ZoneProduct) с их количеством и ориентацией
     *
     * Используется для:
     * - Детального учета емкости стеллажа (сумма объемов полок)
     * - Размещения товара с учетом габаритов упаковки
     * - Подсчета свободного места на стеллаже
     * - Оптимизации использования пространства
     * - Формирования карты размещения товара
     *
     * Согласно ТЗ п.118-120, система должна рассчитывать оставшееся место,
     * поэтому важно знать габариты каждой полки
     */
    @ToString.Exclude
    @OneToMany(mappedBy = "shelf", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<StorageZone> storageZones = new ArrayList<>();

    // ========== КОНСТРУКТОРЫ ==========

    /**
     * Создает новый стеллаж на складе
     * Инициализирует пустой список полок (будут добавлены позже)
     *
     * @param code код (номер) стеллажа для идентификации (например, "A", "ST-01")
     * @param warehouse склад, на котором располагается стеллаж
     */
    public Shelf(String code, Warehouse warehouse) {
        this.code = code;
        this.warehouse = warehouse;
    }

    // ========== МЕТОДЫ ==========

}