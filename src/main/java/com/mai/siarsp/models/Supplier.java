package com.mai.siarsp.models;

import jakarta.persistence.*;
import lombok.Data;
import lombok.EqualsAndHashCode;
import lombok.NoArgsConstructor;
import lombok.ToString;

import java.util.ArrayList;
import java.util.List;

/**
 * Поставщик товаров
 *
 * Организация, которая поставляет товары для ИП "Левчук".
 * Хранит полные реквизиты юридического лица, необходимые для заключения договоров
 * и осуществления платежей.
 *
 * Согласно ТЗ:
 * - Директор заключает контракты с поставщиками и ведет переговоры об условиях поставок
 * - Бухгалтер составляет и изменяет договоры на закупку товара
 * - Бухгалтер осуществляет оплату за закупленный товар
 *
 * Поставщики в контексте бизнеса ИП "Левчук":
 * - Молочные комбинаты (поставка молочной продукции)
 * - Хлебозаводы (поставка хлебобулочных изделий)
 * - Мясокомбинаты (поставка мясной продукции)
 * - Оптовые базы (поставка овощей, фруктов, бакалеи)
 *
 * Критерии выбора поставщика:
 * - Наличие нужных товаров в ассортименте
 * - Качество и свежесть продукции
 * - Цены и условия оплаты
 * - Надежность и своевременность поставок
 * - Территориальная близость (влияет на сроки и стоимость доставки)
 *
 * Связи:
 * - Один поставщик может иметь множество поставок (Delivery)
 * - Один поставщик может получать множество заявок (RequestForDelivery)
 */
@Data
@NoArgsConstructor
@Entity
@Table(name = "t_supplier")
@EqualsAndHashCode(of = "id")
public class Supplier {

    // ========== ПОЛЯ ==========
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    /**
     * Наименование организации-поставщика
     * Полное или сокращенное официальное название
     *
     * Примеры:
     * - "ООО 'Молочный комбинат'"
     * - "ЗАО 'Байконурский хлебозавод'"
     * - "ИП Иванов Петр Сидорович"
     * - "ООО 'Агропром'"
     *
     * Используется в:
     * - Интерфейсе для выбора поставщика
     * - Договорах на закупку товара
     * - Заявках на поставку
     * - Платежных документах
     * - Отчетности по поставщикам
     */
    @Column(nullable = false, length = 200)
    private String name;

    /**
     * Контактная информация
     * Телефон и/или email для связи с поставщиком
     *
     * Примеры:
     * - "+7 (XXX) XXX-XX-XX"
     * - "moloko@combinate.ru, +7-XXX-XXX-XX-XX"
     * - "8-XXX-XXX-XX-XX, доб. 123"
     *
     * Используется для:
     * - Связи с поставщиком при размещении заказа
     * - Уточнения сроков поставки
     * - Решения вопросов по качеству товара
     * - Согласования условий договора
     */
    @Column(length = 100)
    private String contactInfo;

    /**
     * Адрес поставщика
     * Юридический или фактический адрес организации
     *
     * Примеры:
     * - "г. Байконур, ул. Промышленная, д. 15"
     * - "Кызылординская обл., г. Казалинск, ул. Советская, д. 42"
     *
     * Используется в:
     * - Договорах на закупку
     * - Документах на получение товара
     * - Для определения территориальной близости
     */
    @Column(length = 300)
    private String address;

    /**
     * ИНН поставщика (Идентификационный номер налогоплательщика)
     * Уникальный идентификатор в налоговой системе РФ
     *
     * Формат:
     * - 10 цифр для юридических лиц и ИП
     * - 12 цифр для физических лиц
     *
     * Примеры:
     * - "7707083893" (ООО, 10 цифр)
     * - "773301001" (ИП, 10 цифр)
     *
     * Обязателен для:
     * - Заключения договоров
     * - Оформления счетов-фактур
     * - Осуществления платежей
     * - Налоговой отчетности
     *
     * Уникален в системе для идентификации поставщика
     */
    @Column(length = 12, unique = true)
    private String inn;

    /**
     * КПП поставщика (Код причины постановки на учет)
     * Присваивается при регистрации в налоговой инспекции
     *
     * Формат: 9 цифр
     *
     * Пример: "770701001"
     *
     * Используется в:
     * - Договорах
     * - Счетах-фактурах
     * - Платежных документах
     *
     * Обязателен для юридических лиц
     */
    @Column(length = 20)
    private String kpp;

    /**
     * ОГРН поставщика (Основной государственный регистрационный номер)
     * Присваивается при государственной регистрации
     *
     * Формат:
     * - 13 цифр для юридических лиц (ОГРН)
     * - 15 цифр для ИП (ОГРНИП)
     *
     * Примеры:
     * - "1027700132195" (ООО, 13 цифр)
     * - "304770001234567" (ИП, 15 цифр)
     *
     * Используется в:
     * - Договорах
     * - Официальных документах
     * - Проверке легальности организации
     */
    @Column(length = 20)
    private String ogrn;

    /**
     * Расчетный счет поставщика
     * Банковский счет для перечисления оплаты за товар
     *
     * Формат: 20 цифр
     *
     * Пример: "40702810400000001234"
     *
     * Используется бухгалтером при:
     * - Осуществлении оплаты за товар (ТЗ п.259)
     * - Формировании платежных поручений
     * - Перечислении предоплаты
     * - Окончательных расчетах после поставки
     *
     * Обязателен для безналичных расчетов
     */
    @Column(length = 20)
    private String paymentAccount;

    /**
     * БИК банка поставщика (Банковский идентификационный код)
     * Код банка, в котором открыт расчетный счет поставщика
     *
     * Формат: 9 цифр
     *
     * Пример: "044525225" (Сбербанк России)
     *
     * Используется вместе с расчетным счетом для:
     * - Идентификации банка получателя платежа
     * - Формирования платежных поручений
     * - Проведения банковских операций
     */
    @Column(length = 9)
    private String bik;

    /**
     * Наименование банка поставщика
     * Название банка, в котором обслуживается поставщик
     *
     * Примеры:
     * - "ПАО Сбербанк"
     * - "АО 'Альфа-Банк'"
     * - "ВТБ (ПАО)"
     *
     * Используется в:
     * - Договорах
     * - Платежных документах
     * - Счетах на оплату
     */
    @Column(length = 50)
    private String bank;

    /**
     * Фамилия директора (руководителя) поставщика
     * ФИО лица, имеющего право подписи документов
     *
     * Примеры:
     * - "Иванов"
     * - "Петров"
     *
     * Используется в договорах в формате:
     * "Директор ООО 'Молочный комбинат' Иванов И.П."
     *
     * Обязательно для:
     * - Заключения договоров
     * - Подписания актов приема-передачи
     * - Официальной переписки
     */
    @Column(length = 100, nullable = false)
    private String directorLastName;

    /**
     * Имя директора поставщика
     *
     * Примеры:
     * - "Иван"
     * - "Петр"
     *
     * Используется вместе с фамилией и отчеством
     * для формирования полного ФИО
     */
    @Column(length = 100, nullable = false)
    private String directorFirstName;

    /**
     * Отчество директора поставщика
     * В России традиционно используется полное ФИО с отчеством
     *
     * Примеры:
     * - "Иванович"
     * - "Петрович"
     *
     * Может быть пустым для директоров без отчества
     * (иностранные граждане, некоторые национальности)
     */
    @Column(length = 100, nullable = false)
    private String directorPatronymicName;

    /**
     * История поставок от данного поставщика
     * Список всех поставок товаров, которые были получены от поставщика
     *
     * Каждая поставка (Delivery) содержит:
     * - Дату поставки
     * - Список товаров (Supply) с ценами и количеством
     * - Связь с заявкой (RequestForDelivery), если поставка была по заявке
     *
     * Используется для:
     * - Анализа работы с поставщиком (частота, объемы, ассортимент)
     * - Контроля качества поставок (задержки, недопоставки, брак)
     * - Анализа динамики закупочных цен
     * - Выбора оптимального поставщика для товара
     * - Формирования отчетности по закупкам
     * - Расчета оборачиваемости товара от поставщика
     *
     * Пример анализа:
     * Поставщик "ООО Молочный комбинат":
     * - 15 поставок за квартал
     * - Средняя задержка: 1 день
     * - Случаи недопоставки: 2 из 15
     * - Случаи брака: 1 из 15
     * → Надежный поставщик, можно продолжать сотрудничество
     */
    @ToString.Exclude
    @OneToMany(mappedBy = "supplier", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<Delivery> deliveries = new ArrayList<>();

    // ========== КОНСТРУКТОРЫ ==========

    /**
     * Создает нового поставщика с полным набором реквизитов
     *
     * @param name наименование организации-поставщика
     * @param contactInfo контактный телефон и/или email
     * @param address юридический/фактический адрес
     * @param inn ИНН (10 или 12 цифр)
     * @param kpp КПП (9 цифр)
     * @param ogrn ОГРН (13 цифр для ООО, 15 для ИП)
     * @param paymentAccount расчетный счет (20 цифр)
     * @param bik БИК банка (9 цифр)
     * @param bank наименование банка
     * @param directorLastName фамилия директора
     * @param directorFirstName имя директора
     * @param directorPatronymicName отчество директора
     */
    public Supplier(String name, String contactInfo, String address,
                    String inn, String kpp, String ogrn,
                    String paymentAccount, String bik, String bank,
                    String directorLastName, String directorFirstName, String directorPatronymicName) {
        this.name = name;
        this.contactInfo = contactInfo;
        this.address = address;
        this.inn = inn;
        this.kpp = kpp;
        this.ogrn = ogrn;
        this.paymentAccount = paymentAccount;
        this.bik = bik;
        this.bank = bank;
        this.directorLastName = directorLastName;
        this.directorFirstName = directorFirstName;
        this.directorPatronymicName = directorPatronymicName;
    }

    // ========== МЕТОДЫ ==========

    /**
     * Возвращает полное ФИО директора поставщика
     * Формат: "Фамилия Имя Отчество"
     *
     * Примеры:
     * - "Иванов Иван Иванович"
     * - "Петров Петр" (если отчество не указано)
     *
     * Используется в:
     * - Договорах на закупку
     * - Официальной переписке
     * - Актах приема-передачи товара
     *
     * @return полное ФИО директора
     */
    @Transient
    public String getFullName() {
        StringBuilder fullName = new StringBuilder(directorLastName);
        fullName.append(" ").append(directorFirstName);
        if (!directorPatronymicName.isEmpty()) {
            fullName.append(" ").append(directorPatronymicName);
        }
        return fullName.toString().trim();
    }

    /**
     * Возвращает сокращенное ФИО директора поставщика
     * Формат: "Фамилия И.О." (имя и отчество сокращаются до инициалов)
     *
     * Примеры:
     * - "Иванов И.И." (полное отчество)
     * - "Петров П." (без отчества)
     *
     * Используется в:
     * - Компактном отображении в интерфейсе
     * - Кратких формах документов
     * - Списках для выбора
     * - Подписях под документами
     *
     * Пример использования в договоре:
     * "от имени Поставщика: Директор Иванов И.И."
     *
     * @return сокращенное ФИО в формате "Фамилия И.О."
     */
    @Transient
    public String getDirectorShortName() {
        StringBuilder shortName = new StringBuilder(directorLastName);
        shortName.append(" ").append(directorFirstName.charAt(0)).append(".");
        if (!directorPatronymicName.isEmpty()) {
            shortName.append(directorPatronymicName.charAt(0)).append(".");
        }
        return shortName.toString();
    }
}