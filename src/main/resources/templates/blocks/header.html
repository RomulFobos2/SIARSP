<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<div th:fragment="header">
    <div class="bg-dark text-white py-2">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center small">
                <div>
                <span sec:authorize="isAuthenticated()">
                    Добро пожаловать,
                    <a th:href="@{/employee/profile}"
                       class="text-white fw-semibold text-decoration-none border-bottom border-white border-opacity-50"
                       style="cursor: pointer;">
                        <span sec:authentication="principal.fullName"></span>
                    </a>
                </span>
                    <span sec:authorize="!isAuthenticated()">
                    Добро пожаловать в систему СИАРСП
                </span>
                </div>
                <div>
                    <span class="me-3">+7 (XXX) XXX-XX-XX</span>
                    <span>info@siarsp.ru</span>
                </div>
            </div>
        </div>
    </div>

    <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom shadow-sm">
        <div class="container py-2">
            <a class="navbar-brand fw-bold fs-4" th:href="@{/}" style="letter-spacing: 1px;">
                СИАРСП
            </a>

            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarNav" aria-controls="navbarNav"
                    aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-lg-center">

                    <!-- ========== ADMIN ========== -->
                    <li class="nav-item" sec:authorize="hasRole('ROLE_EMPLOYEE_ADMIN')">
                        <a class="nav-link px-3" href="/employee/admin/administrationPanel">
                            Администрирование
                        </a>
                    </li>

                    <!-- ========== MANAGER ========== -->
                    <!-- Dropdown: Справочники -->
                    <li class="nav-item dropdown" sec:authorize="hasRole('ROLE_EMPLOYEE_MANAGER')">
                        <a class="nav-link dropdown-toggle px-3" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Справочники
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/employee/manager/clients/allClients">Клиенты</a></li>
                            <li><a class="dropdown-item" href="/employee/manager/suppliers/allSuppliers">Поставщики</a></li>
                            <li><a class="dropdown-item" href="/employee/manager/vehicles/allVehicles">Транспорт</a></li>
                            <li><a class="dropdown-item" href="/employee/manager/products/allProducts">Товары</a></li>
                        </ul>
                    </li>
                    <!-- Dropdown: Склад -->
                    <li class="nav-item dropdown" sec:authorize="hasRole('ROLE_EMPLOYEE_MANAGER')">
                        <a class="nav-link dropdown-toggle px-3" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Склад
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/employee/manager/warehouses/allWarehouses">Просмотр складов</a></li>
                        </ul>
                    </li>
                    <!-- Dropdown: Закупки -->
                    <li class="nav-item dropdown" sec:authorize="hasRole('ROLE_EMPLOYEE_MANAGER')">
                        <a class="nav-link dropdown-toggle px-3" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Закупки
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/employee/manager/requestsForDelivery/allRequestsForDelivery">Заявки на поставку</a></li>
                        </ul>
                    </li>

                    <!-- ========== WAREHOUSE_MANAGER ========== -->
                    <!-- Dropdown: Товары -->
                    <li class="nav-item dropdown" sec:authorize="hasRole('ROLE_EMPLOYEE_WAREHOUSE_MANAGER')">
                        <a class="nav-link dropdown-toggle px-3" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Товары
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/employee/warehouseManager/globalProductCategories/allGlobalProductCategories">Глобальные категории</a></li>
                            <li><a class="dropdown-item" href="/employee/warehouseManager/productCategories/allProductCategories">Категории товаров</a></li>
                            <li><a class="dropdown-item" href="/employee/warehouseManager/productAttributes/allProductAttributes">Атрибуты товаров</a></li>
                            <li><a class="dropdown-item" href="/employee/warehouseManager/products/allProducts">Товары</a></li>
                        </ul>
                    </li>
                    <!-- Dropdown: Склад -->
                    <li class="nav-item dropdown" sec:authorize="hasRole('ROLE_EMPLOYEE_WAREHOUSE_MANAGER')">
                        <a class="nav-link dropdown-toggle px-3" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Склад
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/employee/warehouseManager/warehouses/allWarehouses">Склады</a></li>
                        </ul>
                    </li>
                    <!-- Dropdown: Закупки -->
                    <li class="nav-item dropdown" sec:authorize="hasRole('ROLE_EMPLOYEE_WAREHOUSE_MANAGER')">
                        <a class="nav-link dropdown-toggle px-3" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Закупки
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/employee/warehouseManager/requestsForDelivery/allRequestsForDelivery">Заявки на поставку</a></li>
                            <li><a class="dropdown-item" href="/employee/warehouseManager/deliveries/allDeliveries">Приёмка поставок</a></li>
                        </ul>
                    </li>

                    <!-- ========== ACCOUNTER ========== -->
                    <!-- Dropdown: Закупки -->
                    <li class="nav-item dropdown" sec:authorize="hasRole('ROLE_EMPLOYEE_ACCOUNTER')">
                        <a class="nav-link dropdown-toggle px-3" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Закупки
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/employee/accounter/requestsForDelivery/allRequestsForDelivery">Заявки на поставку</a></li>
                            <li><a class="dropdown-item" href="/employee/accounter/products/allProducts">Товары</a></li>
                        </ul>
                    </li>

                    <!-- ========== УВЕДОМЛЕНИЯ (все роли) ========== -->
                    <li class="nav-item" sec:authorize="isAuthenticated()">
                        <a class="nav-link px-3 position-relative" href="/employee/notifications/">
                            Уведомления
                            <span id="notificationBadge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="display: none;">
                                0
                            </span>
                        </a>
                    </li>

                    <!-- ========== ВХОД / ВЫХОД ========== -->
                    <li class="nav-item" sec:authorize="!isAuthenticated()">
                        <a class="nav-link px-3" href="/employee/login">Вход</a>
                    </li>

                    <li class="nav-item" sec:authorize="isAuthenticated()">
                        <form th:action="@{/logout}" method="post" class="d-inline">
                            <button type="submit" class="btn btn-outline-dark rounded-pill px-4 ms-lg-2 mt-2 mt-lg-0">
                                Выход
                            </button>
                        </form>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <script sec:authorize="isAuthenticated()">
        document.addEventListener('DOMContentLoaded', function() {
            var badge = document.getElementById('notificationBadge');
            if (badge) {
                fetch('/employee/notifications/unreadCount')
                    .then(function(response) { return response.json(); })
                    .then(function(count) {
                        if (count > 0) {
                            badge.textContent = count;
                            badge.style.display = '';
                        } else {
                            badge.style.display = 'none';
                        }
                    })
                    .catch(function(error) {
                        console.error('Ошибка загрузки уведомлений:', error);
                    });
            }
        });
    </script>
</div>
</html>