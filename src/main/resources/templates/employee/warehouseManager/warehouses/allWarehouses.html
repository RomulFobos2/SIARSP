<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Склады | СИАРСП</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/bootstrap-icons.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
    <script src="/js/bootstrap.bundle.min.js"></script>
</head>
<body class="admin-page">
<header th:insert="~{blocks/header :: header}"></header>

<div class="container my-5">
    <div class="profile-card mb-4">
        <div class="profile-actions">
            <a th:href="'/'" class="btn btn-secondary btn-profile">← Главная</a>
            <a th:href="'/employee/warehouseManager/warehouses/addWarehouse'" class="btn btn-success btn-profile">
                <i class="bi bi-plus-circle"></i> Добавить склад
            </a>
        </div>
    </div>

    <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
    <div th:if="${deleteError}" class="alert alert-danger" th:text="${deleteError}"></div>

    <div class="profile-card p-4">
        <h2 class="h3 mb-4 fw-bold">Склады</h2>

        <div th:if="${#lists.isEmpty(warehouseStats)}" class="text-center text-muted py-5">
            <i class="bi bi-building" style="font-size: 3rem;"></i>
            <p class="mt-3 fs-5">Склады не добавлены</p>
            <a th:href="'/employee/warehouseManager/warehouses/addWarehouse'" class="btn btn-primary mt-2">
                <i class="bi bi-plus-circle"></i> Создать первый склад
            </a>
        </div>

        <div th:if="${!#lists.isEmpty(warehouseStats)}" class="row g-4">
            <div th:each="stat : ${warehouseStats}" class="col-md-6 col-lg-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-header d-flex justify-content-between align-items-center bg-white border-bottom">
                        <h5 class="mb-0 fw-bold text-truncate" th:text="${stat.warehouse().getName()}"></h5>
                        <span class="badge ms-2 flex-shrink-0"
                              th:classappend="${stat.warehouse().getType().name() == 'REFRIGERATOR'} ? 'bg-info text-dark' : 'bg-secondary'"
                              th:text="${stat.warehouse().getType().name() == 'REFRIGERATOR'} ? 'Холодильный' : 'Обычный'"></span>
                    </div>
                    <div class="card-body">
                        <p class="text-muted small mb-3">
                            <i class="bi bi-geo-alt"></i>
                            <span th:text="${stat.warehouse().getAddress() != null ? stat.warehouse().getAddress() : 'Адрес не указан'}"></span>
                        </p>

                        <!-- Прогресс заполненности -->
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-1">
                                <small class="fw-semibold text-muted">Заполненность</small>
                                <small class="fw-semibold"
                                       th:classappend="${stat.occupancyPercent() >= 85} ? 'text-danger' : (${stat.occupancyPercent() >= 60} ? 'text-warning' : 'text-success')"
                                       th:text="${#numbers.formatDecimal(stat.occupancyPercent(), 1, 1)} + '%'"></small>
                            </div>
                            <div class="progress" style="height: 10px;">
                                <div class="progress-bar"
                                     th:classappend="${stat.occupancyPercent() >= 85} ? 'bg-danger' : (${stat.occupancyPercent() >= 60} ? 'bg-warning' : 'bg-success')"
                                     role="progressbar"
                                     th:style="'width: ' + ${#numbers.formatDecimal(stat.occupancyPercent(), 1, 0)} + '%'"
                                     aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>

                        <!-- Мини-статистика -->
                        <div class="d-flex gap-3 text-muted small">
                            <span><i class="bi bi-grid-3x3"></i> <strong th:text="${stat.shelfCount()}"></strong> стеллажей</span>
                            <span><i class="bi bi-layers"></i> <strong th:text="${stat.zoneCount()}"></strong> зон</span>
                        </div>
                    </div>
                    <div class="card-footer bg-white border-top d-flex gap-2">
                        <a th:href="'/employee/warehouseManager/warehouses/detailsWarehouse/' + ${stat.warehouse().getId()}"
                           class="btn btn-sm btn-outline-primary flex-grow-1">
                            <i class="bi bi-info-circle"></i> Детали
                        </a>
                        <a th:href="'/employee/warehouseManager/warehouse-management/analytics/' + ${stat.warehouse().getId()}"
                           class="btn btn-sm btn-outline-secondary flex-grow-1">
                            <i class="bi bi-bar-chart-line"></i> Аналитика
                        </a>
                        <a th:href="'/employee/warehouseManager/warehouses/deleteWarehouse/' + ${stat.warehouse().getId()}"
                           class="btn btn-sm btn-outline-danger"
                           onclick="return confirm('Удалить склад? Это действие необратимо.');">
                            <i class="bi bi-trash"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div th:insert="~{blocks/footer :: footer}"></div>
</body>
</html>
