<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>Смена пароля</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link href="/css/bootstrap.min.css" rel="stylesheet">

    <link href="/css/style.css" rel="stylesheet">
    <script src="/js/bootstrap.bundle.min.js"></script>
</head>

<body class="text-center body-addPage">
<main class="form-addPage">
    <div class="container mt-5 mb-5">
        <form action="/employee/change-password" method="post" id="passwordForm">
            <h1 class="h3 mb-3 fw-normal">Смена пароля</h1>
            <p class="fs-6 text-danger" th:text="${passwordError}"></p>

            <input type="password" name="passwordNew" id="passwordNew"
                   placeholder="Введите новый пароль"
                   class="form-control" required><br>

            <!-- Индикатор надёжности -->
            <div class="text-start mb-2">
                <small id="strengthIndicator" class="fw-bold text-muted"></small>
            </div>

            <input type="password" name="passwordConfirm" id="passwordConfirm"
                   placeholder="Подтвердите новый пароль"
                   class="form-control" required><br>

            <!-- Совпадение паролей -->
            <div class="text-start mb-2">
                <small id="matchMessage" class="fw-bold text-danger" style="display: none;"></small>
            </div>

            <!-- Показать пароль -->
            <div class="form-check mb-3 text-start">
                <input type="checkbox" class="form-check-input" id="togglePassword">
                <label class="form-check-label" for="togglePassword">Показать пароли</label>
            </div>

            <button type="submit" id="submitBtn" class="w-100 btn btn-lg btn-primary">Сменить пароль</button>

            <div class="mt-3">
                <a href="/employee/profile" class="text-dark">На страницу профиля</a>
            </div>

        </form>
    </div>
</main>

<script>
    const passwordNew = document.getElementById('passwordNew');
    const passwordConfirm = document.getElementById('passwordConfirm');
    const submitBtn = document.getElementById('submitBtn');
    const matchMessage = document.getElementById('matchMessage');
    const strengthIndicator = document.getElementById('strengthIndicator');
    const togglePassword = document.getElementById('togglePassword');

    togglePassword.addEventListener('change', () => {
        const type = togglePassword.checked ? 'text' : 'password';
        passwordNew.type = type;
        passwordConfirm.type = type;
    });

    function getPasswordStrength(password) {
        if (password.length < 6) return { level: "Слабый", class: "text-danger" };
        if (password.match(/[A-Z]/) && password.match(/[a-z]/) && password.match(/[0-9]/) && password.length >= 8)
            return { level: "Сильный", class: "text-success" };
        return { level: "Средний", class: "text-warning" };
    }

    function validateForm() {
        const pwd = passwordNew.value;
        const confirmPwd = passwordConfirm.value;

        if (pwd && confirmPwd && pwd !== confirmPwd) {
            matchMessage.textContent = "Пароли не совпадают";
            matchMessage.style.display = "block";
            matchMessage.classList.remove("text-success");
            matchMessage.classList.add("text-danger");
            passwordConfirm.classList.add("is-invalid");
            passwordConfirm.classList.remove("is-valid");
            submitBtn.disabled = true;
        } else if (pwd && confirmPwd) {
            matchMessage.textContent = "Пароли совпадают";
            matchMessage.classList.remove("text-danger");
            matchMessage.classList.add("text-success");
            matchMessage.style.display = "block";
            passwordConfirm.classList.remove("is-invalid");
            passwordConfirm.classList.add("is-valid");
            submitBtn.disabled = false;
        } else {
            matchMessage.style.display = "none";
            passwordConfirm.classList.remove("is-valid", "is-invalid");
            submitBtn.disabled = true;
        }

        const strength = getPasswordStrength(pwd);
        strengthIndicator.textContent = "Надёжность пароля: " + strength.level;
        strengthIndicator.className = `fw-bold ${strength.class}`;
    }

    passwordNew.addEventListener('input', validateForm);
    passwordConfirm.addEventListener('input', validateForm);
</script>
</body>
</html>
